{% extends 'noisesearch/base.html' %}

{% block header %}

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.34.0/mapbox-gl.css' rel='stylesheet' />
{% endblock %}

{% block content %}
    <div id="mapid"></div>

    <script type="text/javascript">
        var mymap = L.map('mapid').setView([48.72305363, 44.53600696], 13);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibGFuY2Vsb2Z0MTAwOCIsImEiOiJjajE4OXExcWkwMDRyMzJwcDNsdDIzMzU4In0.1JIG2H6f-CZ572Wmzxm77g', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            id: 'mapbox.streets'
        }).addTo(mymap);

        var points = {{ points|safe }};

        for (var i = 0; i < points.length; i++){
            var latitude = points[i]["fields"].latitude;
            var longitude = points[i]["fields"].longitude;
            var splvalue = points[i]["fields"].average_spl_value;
            var marker = L.marker([latitude, longitude]).addTo(mymap);
            marker.bindPopup('<b>SPL value:</b><br>' + splvalue.toString() + '<strong> dB</strong><br><br><button type="button" class="btn btn-default" id="' + i.toString() + '" onClick="myFunction(this.id)">Details</button>');
{#            marker.bindPopup('<b>SPL value:</b><br>' + splvalue.toString() + '<strong> dB</strong><br><br><button type="button" class="btn btn-default btn-details"' + 'id="' + i.toString() + '">Details</button>');#}
        }

        function myFunction(clicked_id) {
            var id = clicked_id;

        }

    </script>
{% endblock %}